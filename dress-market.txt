<!doctype html>
<html lang="ar" dir="rtl">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>سوق الفساتين - Prototype</title>
  <link href="https://fonts.googleapis.com/css2?family=Almarai:wght@300;400;700&display=swap" rel="stylesheet">
  <style>
    :root{--pink:#f7d7e6;--accent:#e76a9a;--muted:#666}
    *{box-sizing:border-box}
    body{font-family:'Almarai',sans-serif;margin:0;background:#fff}
    header{background:linear-gradient(90deg, #fff 0%, var(--pink) 100%);padding:18px 20px;display:flex;align-items:center;justify-content:space-between}
    .brand{display:flex;gap:12px;align-items:center}
    .logo{width:48px;height:48px;border-radius:8px;background:linear-gradient(135deg,#ffeff6,#ffdfee);display:flex;align-items:center;justify-content:center;font-weight:700;color:#8b2b4a}
    .searchbar{flex:1;max-width:640px;margin:0 20px;display:flex;gap:8px}
    input, select{padding:10px 12px;border-radius:8px;border:1px solid #eee}
    button{background:var(--accent);color:#fff;border:none;padding:10px 14px;border-radius:8px;cursor:pointer}
    main{padding:18px}
    .grid{display:grid;grid-template-columns:repeat(auto-fill,minmax(220px,1fr));gap:16px}
    .card{border:1px solid #f0e6ee;border-radius:12px;padding:10px;background:#fff}
    .card img{width:100%;height:260px;object-fit:cover;border-radius:8px}
    .card h4{margin:8px 0 4px;font-size:16px}
    .card .price{color:var(--accent);font-weight:700}
    .filters{display:flex;gap:10px;align-items:center;margin-bottom:12px}
    .seller-panel{position:fixed;left:20px;bottom:20px;width:320px;background:#fff;padding:12px;border-radius:12px;box-shadow:0 8px 30px rgba(0,0,0,0.06)}
    .seller-panel h3{margin:0 0 8px}
    label{display:block;font-size:13px;margin-top:8px}
    .small{font-size:13px;color:var(--muted)}
    .modal{position:fixed;inset:0;background:rgba(0,0,0,0.45);display:flex;align-items:center;justify-content:center;padding:20px;display:none}
    .modal .box{background:#fff;padding:18px;border-radius:12px;max-width:720px;width:100%}
    .top-actions{display:flex;gap:8px;align-items:center}
    footer{padding:20px;text-align:center;color:#777}
    @media (max-width:600px){.card img{height:180px}.seller-panel{width:92%}}
  </style>
</head>
<body>
  <header>
    <div class="brand">
      <div class="logo">ف</div>
      <div>
        <div style="font-weight:700">سوق الفساتين</div>
        <div class="small">اجمعي فساتين محلاتك المفضلة هنا</div>
      </div>
    </div>

    <div class="searchbar">
      <input id="q" placeholder="ابحثي عن فستان: لون، نوع، كلمة..." />
      <select id="filter-size">
        <option value="">المقاس</option>
        <option>XS</option>
        <option>S</option>
        <option>M</option>
        <option>L</option>
        <option>XL</option>
      </select>
      <button id="searchBtn">بحث</button>
    </div>

    <div class="top-actions">
      <button id="openSeller">لوحة البائع</button>
      <button id="openLogin">تسجيل / دخول</button>
    </div>
  </header>

  <main>
    <div class="filters">
      <div class="small">فرّزي حسب:</div>
      <select id="sort">
        <option value="new">الأحدث</option>
        <option value="price-asc">السعر: الأقل</option>
        <option value="price-desc">السعر: الأعلى</option>
      </select>
      <div style="margin-left:auto" class="small">عمولتنا التجريبية: <strong id="commission">10%</strong></div>
    </div>

    <section class="grid" id="products"></section>
  </main>

  <div class="seller-panel">
    <h3>لوحة البائع - إضافة فستان</h3>
    <div class="small">هذه لوحة تجريبية تخزن محلياً (localStorage).</div>
    <label>اسم المتجر</label>
    <input id="shop" placeholder="اسم المحل" />
    <label>عنوان الصورة (رابط)</label>
    <input id="img" placeholder="https://..." />
    <label>اسم الفستان</label>
    <input id="title" placeholder="فستان سهرة مثلاً" />
    <label>سعر (EGP)</label>
    <input id="price" type="number" placeholder="500" />
    <label>مقاس</label>
    <select id="size">
      <option>M</option><option>S</option><option>L</option>
    </select>
    <button id="addProduct" style="margin-top:10px">أضف المنتج</button>
    <hr />
    <div style="max-height:160px;overflow:auto" id="myList"></div>
  </div>

  <!-- تفاصيل المنتج (مودال) -->
  <div class="modal" id="modal">
    <div class="box">
      <button id="closeModal" style="float:left">إغلاق</button>
      <div id="detailContent"></div>
    </div>
  </div>

  <!-- تسجيل/دخول بسيط -->
  <div class="modal" id="loginModal">
    <div class="box" style="max-width:420px">
      <button id="closeLogin" style="float:left">إغلاق</button>
      <h3>تسجيل/دخول تجريبي</h3>
      <div class="small">هذا تسجيل تجريبي يحفظ اسم المستخدم محلياً فقط.</div>
      <label>الاسم</label>
      <input id="userName" placeholder="اسمك" />
      <button id="saveUser" style="margin-top:12px">حفظ</button>
    </div>
  </div>

  <footer>نسخة تجريبية • لو محتاج تعديل في التصميم أو إضافة دولاب (checkout، بوابات دفع، مراجعة صور) كلمنا.</footer>

  <script>
    // بيانات أولية تجريبية
    const sample = [
      {id:1,title:'فستان سواريه وردي',price:1200,size:'M',img:'https://images.unsplash.com/photo-1520975910403-6ff385b6a0c8?auto=format&fit=crop&w=800&q=60',shop:'كشخة بوتيك'},
      {id:2,title:'فستان قصير أنيق',price:650,size:'S',img:'https://images.unsplash.com/photo-1503342452485-86f7f2b8b0b6?auto=format&fit=crop&w=800&q=60',shop:'نور للفساتين'},
      {id:3,title:'فستان طويل ذهبي',price:2300,size:'L',img:'https://images.unsplash.com/photo-1541099649105-f69ad21f3246?auto=format&fit=crop&w=800&q=60',shop:'ليالي'},
      {id:4,title:'فستان خطوبة أبيض',price:3000,size:'M',img:'https://images.unsplash.com/photo-1520975910404-9d5f5f6b4e35?auto=format&fit=crop&w=800&q=60',shop:'ستايلانا'}
    ];

    const COMMISSION = 0.10; // 10% افتراضي
    document.getElementById('commission').innerText = (COMMISSION*100)+'%';

    // إدارة المنتجات (localStorage)
    function loadProducts(){
      const raw = localStorage.getItem('products_v1');
      return raw?JSON.parse(raw):sample.slice();
    }
    function saveProducts(arr){ localStorage.setItem('products_v1',JSON.stringify(arr)); }

    function renderProducts(list){
      const cont = document.getElementById('products'); cont.innerHTML='';
      if(!list.length) cont.innerHTML='<div class="small">لا توجد منتجات مطابقة</div>';
      list.forEach(p=>{
        const el = document.createElement('div'); el.className='card';
        el.innerHTML = `
          <img src="${p.img}" alt="${p.title}" onerror="this.src='https://via.placeholder.com/400x400?text=No+Image'"/>
          <h4>${p.title}</h4>
          <div class="small">المحل: ${p.shop}</div>
          <div class="price">${p.price} جنيه</div>
          <div style="margin-top:8px;display:flex;gap:8px">
            <button onclick="openDetail(${p.id})">عرض التفاصيل</button>
            <button onclick="contactSeller(${p.id})" style="background:#444">تواصل</button>
          </div>
        `;
        cont.appendChild(el);
      })
    }

    function openDetail(id){
      const prod = loadProducts().find(x=>x.id===id);
      const box = document.getElementById('detailContent');
      const commissionVal = Math.round(prod.price*COMMISSION);
      box.innerHTML = `
        <div style="display:flex;gap:16px;flex-wrap:wrap">
          <img src="${prod.img}" style="max-width:320px;width:100%;border-radius:8px" />
          <div style="flex:1">
            <h2>${prod.title}</h2>
            <div class="small">المحل: ${prod.shop}</div>
            <p>المقاس: ${prod.size}</p>
            <p class="price">السعر: ${prod.price} جنيه</p>
            <p class="small">عمولة الموقع: ${commissionVal} جنيه (${COMMISSION*100}%)</p>
            <button onclick="alert('محاكاة: إرسال رسالة للمحل')">إرسال رسالة للمحل</button>
          </div>
        </div>
      `;
      document.getElementById('modal').style.display='flex';
    }

    function contactSeller(id){
      const prod = loadProducts().find(x=>x.id===id);
      alert('ستُفتح نافذة تواصل مع: '+prod.shop+' (محاكاة)');
    }

    // البحث والفلاتر
    function queryAndRender(){
      const q = document.getElementById('q').value.trim().toLowerCase();
      const size = document.getElementById('filter-size').value;
      const sort = document.getElementById('sort').value;
      let list = loadProducts();
      if(q) list = list.filter(p=> (p.title+p.shop).toLowerCase().includes(q));
      if(size) list = list.filter(p=>p.size===size);
      if(sort==='price-asc') list.sort((a,b)=>a.price-b.price);
      if(sort==='price-desc') list.sort((a,b)=>b.price-a.price);
      if(sort==='new') list.sort((a,b)=>b.id-a.id);
      renderProducts(list);
    }

    // إضافة منتج (لوحة البائع)
    document.getElementById('addProduct').addEventListener('click',()=>{
      const shop = document.getElementById('shop').value.trim()||'محل تجريبي';
      const img = document.getElementById('img').value.trim()||'https://via.placeholder.com/800x800?text=+Dress';
      const title = document.getElementById('title').value.trim()||'فستان جديد';
      const price = Number(document.getElementById('price').value)||500;
      const size = document.getElementById('size').value||'M';
      const arr = loadProducts();
      const id = Date.now();
      arr.unshift({id,title,price,size,img,shop});
      saveProducts(arr);
      renderMyList();
      queryAndRender();
      alert('تم إضافة المنتج (محلياً)');
    });

    function renderMyList(){
      const arr = loadProducts();
      const box = document.getElementById('myList'); box.innerHTML='';
      arr.slice(0,20).forEach(p=>{
        const d = document.createElement('div'); d.style.padding='6px 0'; d.innerHTML=`<strong>${p.title}</strong> — ${p.price} جنيه <button style="float:left" onclick="removeProduct(${p.id})">حذف</button>`;
        box.appendChild(d);
      })
    }
    window.removeProduct = function(id){
      const arr = loadProducts().filter(x=>x.id!==id); saveProducts(arr); renderMyList(); queryAndRender();
    }

    // مودالات
    document.getElementById('closeModal').addEventListener('click',()=>document.getElementById('modal').style.display='none');
    document.getElementById('openSeller').addEventListener('click',()=>{
      window.scrollTo({top:document.body.scrollHeight,behavior:'smooth'});
      document.querySelector('.seller-panel').style.boxShadow='0 12px 40px rgba(0,0,0,0.12)';
    });

    document.getElementById('openLogin').addEventListener('click',()=>document.getElementById('loginModal').style.display='flex');
    document.getElementById('closeLogin').addEventListener('click',()=>document.getElementById('loginModal').style.display='none');
    document.getElementById('saveUser').addEventListener('click',()=>{
      const name = document.getElementById('userName').value.trim();
      if(!name){alert('اكتب اسمك');return}
      localStorage.setItem('dress_user',name); alert('تم حفظ الاسم محلياً: '+name); document.getElementById('loginModal').style.display='none';
    });

    // بحث زر
    document.getElementById('searchBtn').addEventListener('click',queryAndRender);
    document.getElementById('q').addEventListener('keydown',(e)=>{ if(e.key==='Enter') queryAndRender(); });
    document.getElementById('filter-size').addEventListener('change',queryAndRender);
    document.getElementById('sort').addEventListener('change',queryAndRender);

    // init
    if(!localStorage.getItem('products_v1')) saveProducts(sample);
    renderMyList();
    queryAndRender();
  </script>
</body>
</html>
